# 🚀 神笔马良 2.0 开发路线图

> **关联 Issue**: [#16 - 神笔马良 2.0 版本规划 - 全面升级](https://github.com/qqyule/soul-canvas-ai/issues/16)
>
> **文档更新日期**: 2026-01-03

---

## 📋 项目概述

将神笔马良从一个简单的 AI 草图生成工具，升级为功能丰富、技术先进、体验一流的 AI 创意平台。本次升级聚焦于**实用性增强**、**创意功能扩展**和**前沿技术探索**三大维度。

---

## 🗓️ 开发优先级与分支规划

### P0 - 核心体验 (第一阶段)

> 基础设施和核心功能，必须优先完成

| 功能模块            | 开发分支                      | 状态      | 负责人 | 备注                   |
| ------------------- | ----------------------------- | --------- | ------ | ---------------------- |
| Neon 数据库集成     | `feature/neon-database`       | 🟢 已完成 | -      | Drizzle ORM + Zod 验证 |
| 用户认证系统 (Auth) | `feature/user-auth`           | 🟢 已完成 | -      | Clerk + Neon 自动同步  |
| AI 执行容错性提升   | `feature/ai-fault-tolerance`  | 🟢 已完成 | -      | 重试机制、错误处理     |
| 画板图层系统        | `feature/canvas-layer-system` | 🟡 开发中 | -      | 多图层编辑、锁定/隐藏  |
| 局部重绘功能        | `feature/inpainting`          | 🟡 开发中 | -      | 选中区域单独重新生成   |
| 草稿自动保存        | `feature/auto-save-draft`     | 🟡 开发中 | -      | 防止意外丢失           |

### P1 - 差异化功能 (第二阶段)

> 提升产品竞争力的特色功能

| 功能模块             | 开发分支                     | 状态      | 负责人 | 备注                   |
| -------------------- | ---------------------------- | --------- | ------ | ---------------------- |
| Three.js 3D 效果系统 | `feature/threejs-effects`    | 🟡 开发中 | -      | 3D 背景、粒子效果      |
| 批量生成 & 变体      | `feature/batch-generation`   | 🟡 开发中 | -      | 一次生成多个变体       |
| 自定义风格           | `feature/custom-styles`      | 🟡 开发中 | -      | 用户上传参考图创建风格 |
| 快捷键系统           | `feature/keyboard-shortcuts` | 🟡 开发中 | -      | 完整的键盘快捷键支持   |

### P2 - 生态建设 (第三阶段)

> 长期价值和用户生态

| 功能模块          | 开发分支 | 状态      | 负责人 | 备注            |
| ----------------- | -------- | --------- | ------ | --------------- |
| 作品集 & 社区画廊 | `待创建` | ⚪ 待开始 | -      | -               |
| 国际化支持        | `待创建` | ⚪ 待开始 | -      | -               |
| PWA 离线支持      | `待创建` | ⚪ 待开始 | -      | -               |
| 前沿技术实验功能  | `待创建` | ⚪ 待开始 | -      | WebGPU、WASM 等 |

---

## 📊 状态图例

- ⚪ **待开始** - 尚未创建分支或开始开发
- 🟡 **开发中** - 分支已创建，正在开发
- 🟢 **已完成** - 开发完成，已合并到主分支
- 🔴 **阻塞中** - 遇到问题，需要解决

---

## 📁 分支命名规范

```
feature/<功能名称>    # 新功能开发
fix/<问题描述>        # Bug 修复
refactor/<重构内容>   # 代码重构
docs/<文档内容>       # 文档更新
```

---

## 📝 详细功能清单

### 一、核心功能增强

#### 1.1 画板能力升级

| 功能项                                    | 状态 | 分支                          |
| ----------------------------------------- | ---- | ----------------------------- |
| 图层系统: 多图层编辑、锁定/隐藏、混合模式 | 🟡   | `feature/canvas-layer-system` |
| 更多画笔工具: 铅笔、马克笔、水彩笔、喷枪  | ⚪   | 待创建                        |
| 形状工具: 矩形、圆形、多边形、箭头        | ⚪   | 待创建                        |
| 选区工具: 套索选区、矩形选区              | ⚪   | 待创建                        |
| 参考图功能: 上传参考图作为底图描摹        | ⚪   | 待创建                        |
| 画布缩放/平移: 自由缩放和平移             | ⚪   | 待创建                        |

#### 1.2 AI 生成能力增强

| 功能项                        | 状态 | 分支                       |
| ----------------------------- | ---- | -------------------------- |
| 局部重绘 (Inpainting)         | 🟡   | `feature/inpainting`       |
| 图像放大 (Upscale) 2x/4x      | ⚪   | 待创建                     |
| 批量生成                      | 🟡   | `feature/batch-generation` |
| 生成参数调节 (temperature 等) | ⚪   | 待创建                     |
| 负向提示词                    | ⚪   | 待创建                     |
| 多模型切换                    | ⚪   | 待创建                     |

#### 1.3 用户体验优化

| 功能项                     | 状态 | 分支                         |
| -------------------------- | ---- | ---------------------------- |
| 草稿保存: 自动保存画布状态 | 🟡   | `feature/auto-save-draft`    |
| 快捷键系统                 | 🟡   | `feature/keyboard-shortcuts` |
| 移动端手势优化             | ⚪   | 待创建                       |
| 深色/浅色主题              | ⚪   | 待创建                       |
| 国际化 (i18n)              | ⚪   | 待创建                       |

---

### 二、AI 执行容错性提升

#### 2.1 请求层容错

| 功能项                     | 状态 | 分支                         |
| -------------------------- | ---- | ---------------------------- |
| 智能重试机制: 指数退避策略 | 🟢   | `feature/ai-fault-tolerance` |
| 请求队列管理: 防止重复请求 | 🟢   | `feature/ai-fault-tolerance` |
| 断点续传                   | ⚪   | 待创建                       |
| 多 API 端点 fallback       | ⚪   | 待创建                       |

#### 2.2 生成过程容错

| 功能项       | 状态 | 分支                         |
| ------------ | ---- | ---------------------------- |
| 进度反馈增强 | 🟡   | `feature/ai-fault-tolerance` |
| 超时智能处理 | 🟢   | `feature/ai-fault-tolerance` |
| 错误分类处理 | 🟢   | `feature/ai-fault-tolerance` |
| 草图验证     | ⚪   | 待创建                       |

#### 2.3 结果校验与优化

| 功能项       | 状态 | 分支   |
| ------------ | ---- | ------ |
| 生成结果评分 | ⚪   | 待创建 |
| 内容安全过滤 | ⚪   | 待创建 |
| 生成日志记录 | ⚪   | 待创建 |

---

### 三、创意功能扩展

#### 3.1 风格系统增强

| 功能项     | 状态 | 分支                    |
| ---------- | ---- | ----------------------- |
| 自定义风格 | 🟡   | `feature/custom-styles` |
| 风格融合   | ⚪   | 待创建                  |
| 风格收藏夹 | ⚪   | 待创建                  |
| 社区风格库 | ⚪   | 待创建                  |

#### 3.2 创意工作流

| 功能项       | 状态 | 分支   |
| ------------ | ---- | ------ |
| 草图到动画   | ⚪   | 待创建 |
| 连续创作模式 | ⚪   | 待创建 |
| 创意提示建议 | ⚪   | 待创建 |
| 风格迁移     | ⚪   | 待创建 |

#### 3.3 协作与分享

| 功能项        | 状态 | 分支   |
| ------------- | ---- | ------ |
| 作品集功能    | ⚪   | 待创建 |
| 社区画廊      | ⚪   | 待创建 |
| 一键分享      | ⚪   | 待创建 |
| 协作画布 (P1) | ⚪   | 待创建 |

---

### 四、技术栈升级与探索

#### 4.1 Three.js 3D 可视化引入

| 功能项            | 状态 | 分支                      |
| ----------------- | ---- | ------------------------- |
| 3D 画布背景       | 🟡   | `feature/threejs-effects` |
| 3D 作品展示       | 🟡   | `feature/threejs-effects` |
| 3D 风格预览       | ⚪   | 待创建                    |
| 粒子效果系统      | 🟡   | `feature/threejs-effects` |
| 交互式 3D Gallery | ⚪   | 待创建                    |

#### 4.2 性能优化

| 功能项             | 状态 | 分支   |
| ------------------ | ---- | ------ |
| Canvas 渲染优化    | ⚪   | 待创建 |
| 图像压缩           | ⚪   | 待创建 |
| 懒加载             | ⚪   | 待创建 |
| Service Worker/PWA | ⚪   | 待创建 |
| 代码分割           | ⚪   | 待创建 |

#### 4.3 前沿技术探索

| 功能项             | 状态 | 分支   |
| ------------------ | ---- | ------ |
| WebGPU 加速        | ⚪   | 待创建 |
| WASM 图像处理      | ⚪   | 待创建 |
| MediaPipe 手势识别 | ⚪   | 待创建 |
| 语音交互           | ⚪   | 待创建 |

#### 4.4 架构演进

| 功能项                       | 状态 | 分支              |
| ---------------------------- | ---- | ----------------- |
| 状态管理升级 (Zustand/Jotai) | ⚪   | 待创建            |
| API 层重构                   | ⚪   | 待创建            |
| 错误边界完善                 | ⚪   | 待创建            |
| 监控与日志 (Sentry)          | 🟡   | `feat/add-sentry` |

---

### 五、用户系统与数据持久化

#### 5.1 Neon 数据库集成

| 功能项               | 状态 | 分支                    |
| -------------------- | ---- | ----------------------- |
| Neon PostgreSQL 接入 | 🟢   | `feature/neon-database` |
| 数据模型设计         | 🟢   | `feature/neon-database` |
| ORM 集成 (Drizzle)   | 🟢   | `feature/neon-database` |
| Zod 数据验证         | 🟢   | `feature/neon-database` |
| 单元测试 (Vitest)    | 🟢   | `feature/neon-database` |
| 数据库迁移           | ⚪   | 待创建                  |
| 连接池优化           | ⚪   | 待创建                  |

#### 5.2 用户认证系统 (Auth)

| 功能项               | 状态 | 分支                |
| -------------------- | ---- | ------------------- |
| 多种登录方式         | 🟢   | `feature/user-auth` |
| Session 管理         | 🟢   | `feature/user-auth` |
| JWT Token            | 🟢   | `feature/user-auth` |
| 权限系统             | ⚪   | 待创建              |
| 第三方 Auth 服务集成 | ⚪   | 待创建              |

#### 5.3 用户数据同步

| 功能项         | 状态 | 分支   |
| -------------- | ---- | ------ |
| 作品云端存储   | ⚪   | 待创建 |
| 跨设备同步     | ⚪   | 待创建 |
| 历史记录持久化 | ⚪   | 待创建 |
| 偏好设置同步   | ⚪   | 待创建 |

---

### 六、数据与分析

#### 6.1 用户数据

| 功能项     | 状态 | 分支   |
| ---------- | ---- | ------ |
| 使用统计   | ⚪   | 待创建 |
| 创作里程碑 | ⚪   | 待创建 |
| 数据导出   | ⚪   | 待创建 |

#### 6.2 产品分析

| 功能项       | 状态 | 分支              |
| ------------ | ---- | ----------------- |
| 埋点系统     | ⚪   | 待创建            |
| A/B 测试框架 | ⚪   | 待创建            |
| 性能监控     | 🟡   | `feat/add-sentry` |

---

## 📎 相关资源

- **当前技术栈**: React 18 + Vite + TypeScript + Tailwind CSS
- **AI 服务**: OpenRouter API
- **部署平台**: 阿里云 ESA Pages

---

## 📅 更新日志

| 日期       | 更新内容                                                                    |
| ---------- | --------------------------------------------------------------------------- |
| 2026-01-03 | 完成用户认证系统：集成 Clerk，实现登录/注册及 Neon 数据自动同步             |
| 2026-01-03 | 完成 AI 执行容错性提升：实现指数退避重试、超时控制及错误分类处理            |
| 2026-01-03 | 完成 Neon 数据库集成：包含 Schema 设计、Repository 封装、Zod 验证和单元测试 |
| 2026-01-03 | 初始化开发路线图文档，关联 Issue #16                                        |

---

## 🔗 其他开发分支

以下是项目中已存在的其他开发分支（非 Issue #16 相关）：

| 分支名                       | 用途              |
| ---------------------------- | ----------------- |
| `feat/issue-11-user-guide`   | 用户指南功能      |
| `feat/star-reward-quota`     | Star 奖励配额     |
| `feature/add-prompt-box`     | 提示词输入框      |
| `fix/mobile-ui-improvements` | 移动端 UI 优化    |
| `fix/seo`                    | SEO 优化          |
| `fix/webfront-api`           | Webfront API 修复 |
| `refactor/ai-prompts`        | AI 提示词重构     |
